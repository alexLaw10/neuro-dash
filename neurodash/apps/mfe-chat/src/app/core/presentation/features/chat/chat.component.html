<div class="chat-container">
  <div class="chat-header">
    <h2>ğŸš€ Chat Angular MFE</h2>
    <div class="agent-info">
      <span class="agent-label">Agente:</span>
      <span class="agent-id">{{ agentInfo?.name || agentId }}</span>
      <span class="agent-status" [class.offline]="isAgentOffline" [class.online]="!isAgentOffline">
        {{ isAgentOffline ? 'ğŸ”´ Offline' : 'ğŸŸ¢ Online' }}
      </span>
      <span class="message-count">({{ messages.length }} mensagens)</span>
    </div>
  </div>
  <div class="chat-interface">
    <div class="message-list">
      <div *ngIf="isLoading" class="loading">Carregando mensagens...</div>
      <div *ngIf="!isLoading && messages.length === 0" class="no-messages">
        <div *ngIf="isAgentOffline" class="offline-message">
          <p>ğŸ”´ Agente offline</p>
          <p>VocÃª pode visualizar o histÃ³rico, mas nÃ£o pode enviar novas mensagens.</p>
        </div>
        <div *ngIf="!isAgentOffline">
          Nenhuma mensagem ainda. Inicie a conversa!
        </div>
      </div>
      <div 
        *ngFor="let message of messages" 
        class="message" 
        [class.user]="message.sender === 'user'"
        [class.agent]="message.sender === 'agent'"
      >
        <div class="message-header">
          <span class="sender-name">{{ message.sender === 'user' ? 'VocÃª' : 'Agente' }}</span>
          <span class="message-id">#{{ message.id }}</span>
        </div>
        <div class="message-content">{{ message.message }}</div>
        <div class="message-footer">
          <span class="message-time">{{ message.timestamp | date:'dd/MM/yyyy HH:mm:ss' }}</span>
          <span *ngIf="message.isTyping" class="typing-indicator">Digitando...</span>
        </div>
        <div class="message-debug" *ngIf="false">
          <small>
            AgentId: {{ message.agentId }} | 
            Created: {{ message.createdAt | date:'short' }} | 
            Updated: {{ message.updatedAt | date:'short' }}
          </small>
        </div>
      </div>
      
      <!-- Indicador de digitaÃ§Ã£o do agente -->
      <div *ngIf="isAgentTyping" class="message agent typing-message">
        <div class="typing-indicator">
          <span class="typing-dots">
            <span>.</span>
            <span>.</span>
            <span>.</span>
          </span>
          Agente estÃ¡ digitando...
        </div>
      </div>
    </div>
    <div class="input-area" [class.disabled]="isAgentOffline">
      <form [formGroup]="messageForm" (ngSubmit)="sendMessage()">
        <input 
          formControlName="message" 
          type="text" 
          [placeholder]="isAgentOffline ? 'Agente offline - nÃ£o Ã© possÃ­vel enviar mensagens' : 'Digite sua mensagem...'" 
          class="message-input"
          [disabled]="isLoading || isAgentOffline"
        >
        <button 
          type="submit" 
          class="send-button" 
          [disabled]="isLoading || !messageForm.value.message || isAgentOffline"
          [title]="isAgentOffline ? 'Agente offline - nÃ£o Ã© possÃ­vel enviar mensagens' : 'Enviar mensagem'"
        >
          {{ isAgentOffline ? 'ğŸ”´' : 'Enviar' }}
        </button>
      </form>
      <div *ngIf="isAgentOffline" class="offline-notice">
        <small>ğŸ”´ Agente offline - Chat somente para leitura</small>
      </div>
    </div>
  </div>
</div>
